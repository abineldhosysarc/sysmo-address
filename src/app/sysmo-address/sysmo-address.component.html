<form [formGroup]="addressForm">
  <div formArrayName="addresses">
    <div *ngFor="let address of getAddresses().controls; let i = index" [formGroupName]="i">
      
      <ion-item *ngIf="i > 0">
        <ion-checkbox (ionChange)="copyAddress(i)" slot="start"></ion-checkbox>
        <ion-label>Same as Above</ion-label>
      </ion-item>

      <ion-card>
        <ion-card-header>
          <ion-card-title>{{ address.get('label')?.value }}</ion-card-title>
        </ion-card-header>

        <ion-card-content>
          <ng-container *ngFor="let field of addressFields">
            <ion-item [class.ion-invalid]="isFieldInvalid(address, field.id)" class="ion-touched">
              <ion-label position="floating">
                {{ field.label }}{{ address.get('required')?.value && field.required ? ' *' : '' }}
              </ion-label>
              <ion-input 
                [formControlName]="field.id"
                [type]="field.type"
                [attr.maxlength]="field.maxLength"
                [required]="address.get('required')?.value && field.required"
              ></ion-input>
              <ion-note slot="error" *ngIf="isFieldInvalid(address, field.id)">
                {{ getFieldErrorMessage(address, field) }}
              </ion-note>
            </ion-item>
          </ng-container>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</form>